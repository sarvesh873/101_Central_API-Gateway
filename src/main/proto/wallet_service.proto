syntax = "proto3";

package com.central.wallet;

import "google/protobuf/timestamp.proto";

option java_multiple_files = true;
option java_package = "com.central.wallet";
option java_outer_classname = "WalletServiceProto";

// --- Service Definition ---

service WalletService {

  // Retrieves the current balance and associated user information for a specific userCode.
  rpc GetUserWallet (GetWalletRequestGRPC) returns (WalletResponseGRPC);

  // Increases the wallet balance and initiates a ledger entry.
  rpc DepositFunds (WalletTransactionRequestGRPC) returns (WalletTransactionResponseGRPC);

  // Retrieves details of a specific hold.
  rpc GetHold (GetHoldRequestGRPC) returns (HoldResponseGRPC);

  // Retrieves a paginated list of holds with optional filtering.
  rpc ListHolds (ListHoldsRequestGRPC) returns (ListHoldsResponseGRPC);

  // Extends the expiration time of an existing hold.
  rpc ExtendHold (ExtendHoldRequestGRPC) returns (HoldResponseGRPC);

  // Adjusts the amount of an existing hold (increase or decrease).
  rpc AdjustHold (AdjustHoldRequestGRPC) returns (HoldResponseGRPC);

}

// --- Request/Response Messages ---

message GetWalletRequestGRPC {
  // The unique code of the user whose wallet is being fetched.
  string user_code = 1;
}

message WalletResponseGRPC {
  // Unique identifier of the wallet.
  int64 wallet_id = 1;
  // The unique user identifier.
  string user_code = 2;
  // Current ledger balance in the wallet (including holds).
  double balance = 3;
  // The status of the wallet.
  string status = 4;
  // The currency code (e.g., USD, EUR).
  string currency = 5;
  // Current available balance in the wallet (excluding active holds).
  double available_balance = 6;
  // Timestamp when the wallet was created.
  google.protobuf.Timestamp created_at = 7;

  // Snapshot data replicated from the User Service.
  optional string username = 8;
  optional string email = 9;
  optional string phone_number = 10;
}

// Used for both deposit and withdrawal requests.
message WalletTransactionRequestGRPC {
  // The user code associated with the wallet.
  string user_code = 1;
  // The monetary amount to transfer.
  double amount = 2;
  // The currency code (e.g., USD, EUR).
  string currency = 3;
}

message WalletTransactionResponseGRPC {
  enum TransactionTypeGRPC {
    UNKNOWN_TYPE = 0;
    DEPOSIT = 1;
    WITHDRAWAL = 2;
  }
  enum TransactionStatusGRPC {
    UNKNOWN_STATUS = 0;
    COMPLETED = 1;
    FAILED = 2;
    DECLINED = 3;
    EXPIRED = 4;
  }

  int64 wallet_id = 1;
  TransactionTypeGRPC transaction_type = 2;
  double processed_amount = 3;
  double new_balance = 4;
  double new_available_balance = 5;
  string user_code = 6;
  TransactionStatusGRPC status = 7;

  // Snapshot data for context
  optional string username = 8;
  optional string email = 9;
  optional string phone_number = 10;
}

message GetHoldRequestGRPC {
  string hold_id = 1;
}

message ExtendHoldRequestGRPC {
  string hold_id = 1;
  google.protobuf.Timestamp new_expires_at = 2;
  string reason = 3;
}

message AdjustHoldRequestGRPC {
  string hold_id = 1;
  double new_amount = 2;
  string reason = 3;
}

message ListHoldsRequestGRPC {
  // Optional: Filter by user code (exact match)
  string user_code = 1;
  // Optional: Filter by status (ACTIVE, CAPTURED, RELEASED, EXPIRED)
  string status = 2;
  // Optional: Filter by currency code (exact match)
  string currency = 3;
  // Optional: Filter by creation date range (inclusive)
  google.protobuf.Timestamp from_date = 4;
  // Optional: Filter by creation date range (inclusive)
  google.protobuf.Timestamp to_date = 5;
  // Optional: Pagination and sorting parameters
  PaginationRequestGRPC pagination = 6;
  // Optional: Filter by transaction ID (exact match)
  string transaction_id = 7;
  // Optional: Filter by minimum amount (inclusive)
  double min_amount = 8;
  // Optional: Filter by maximum amount (inclusive)
  double max_amount = 9;
  // Optional: Filter by description (case-insensitive contains)
  string description = 10;
  // Optional: If true, only return expired holds
  bool expired_only = 11;
  // Optional: If true, only return active holds (not expired, not captured, not released)
  bool active_only = 12;
}

message ListHoldsResponseGRPC {
  repeated HoldResponseGRPC items = 1;
  PaginationResponseGRPC pagination = 2;
}

message HoldResponseGRPC {
  enum HoldStatusGRPC {
    UNKNOWN = 0;
    ACTIVE = 1;
    CAPTURED = 2;
    RELEASED = 3;
    EXPIRED = 4;
  }

  string hold_id = 1;
  string transaction_id = 2;
  string user_code = 3;
  HoldStatusGRPC status = 4;
  double original_amount = 5;
  double remaining_amount = 6;
  double captured_amount = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp expires_at = 9;
  google.protobuf.Timestamp updated_at = 10;
  string description = 11;
  optional string username = 12;
  optional string email = 13;
  optional string phone_number = 14;
}

// Request structure for pagination and sorting.
message PaginationRequestGRPC {
  // The page number to retrieve (1-based).
  int32 page = 1;
  // Number of items per page (default 20).
  int32 page_size = 2;
  // Field to sort by (e.g., 'createdAt').
  string sort_by = 3;
  // Sort in descending order (default true).
  bool sort_descending = 4;
}

// Response structure for pagination metadata.
message PaginationResponseGRPC {
  // Total number of items across all pages.
  int64 total_items = 1;
  // Total number of pages.
  int32 total_pages = 2;
  // Current page number (1-based).
  int32 current_page = 3;
  // Number of items per page.
  int32 page_size = 4;
  // Whether there is a next page.
  bool has_next = 5;
  // Whether there is a previous page.
  bool has_previous = 6;
}